{% load static %}
{% load humanize%}
 


    {% include 'ss/head.html' %}

    {% include "ss/header.html" %}

<html>
   
    
    <article class="bangsp">
        <img src="{{ctsp.hinh_anh.first.hinh.url}}" alt="" class="sp">
        <section class="noidung">
           [New Chính Hãng] {{ctsp.ten_sp}}
           <p class="noidung1">
                &nbsp; -Thương hiệu: {{ ctsp.nhacungcap }} <br>
                &nbsp; -Mã sản phẩm: {{ ctsp.ma_sp }} <br>
                &nbsp; -Mô tả: {{ ctsp.mo_ta }} <br>
                &nbsp; -Giá tốt nhất thị trường <br>
                &nbsp; -Xem trực tiếp sản phẩm tại: 122/27/117/9/9 Tôn Đản Phường Khánh Hội TP.HCM  <br>
            </p>
           {%if ctsp.giam_gia%}
                    Giá: <span id='giatien'> <s style ="color: black; font-size:20px">{{ ctsp.gia | floatformat:0 | intcomma }} </s> 
                    &nbsp{{  ctsp.giam_gia | floatformat:0 | intcomma }} </span> <br>
                {%else%}
                    Giá: <span id='giatien'>
                    {{ ctsp.gia_ban | floatformat:0 | intcomma }} </span> <br>
                {%endif%}
           <p class="noidung1">
            {% if user.is_authenticated %}
    {% if user.is_staff %}
        
        <form action="{% url 'x' ctsp.ma_sp %}" method="post" style="margin-top:10px;">
            {% csrf_token %}
            <button class="o1 btn-card bi" type="submit" name='x'>Xóa sản phẩm</button> 
        </form>
        <button class="o2 bi" type="submit" name='s'>Sửa sản phẩm</button>
    {% else %}
        
        <form method="post" action="{% url 'tvg' %} " class="khung">
            {% csrf_token %}
            
            
            <input type="hidden" name="masp" value="{{ ctsp.ma_sp }}">

            
            <label class="noidung1">Size [kích thước]</label><br>
            <select name="size_id" id="size-select">
                <option value="">Chọn size</option>
                {% for s in soluong %}
                    <option value="{{ s.id }}" 
                            data-soluong="{{ s.so_luong }}" 
                            data-gia="{{ s.gia_tuy_chinh }}">
                        Size {{ s.size.size }}
                    </option>
                {% endfor %}
            </select>
            <span id="tonkho"></span><br>

    <label class="noidung1">Số lượng:</label><br>
    <input type="number" name="sl" min="1" value="1" style="width:15%;" class="noidung1"><br>

            <!-- Nút -->
            <button class="o1 btn-card bi bi-cart-plus" type="submit" name="action" value="add">
                Thêm vào giỏ
            </button>
            <button class="o2 bi bi-wallet2" type="submit" name="action" value="buy">
                Mua ngay
            </button>
        </form>
    {% endif %}
{% else %}
    <p class="noidung1">
        Hãy đăng nhập để mua hàng 
        <a href="{% url 'dn' %}">Tại đây</a>
    </p>
    <p class="noidung1">
        Hoặc tạo tài khoản mới 
        <a href="{% url 'dk' %}">Tại đây</a>
    </p>
{% endif %}
          
            
        </section>
    </article>

    
</html>



{% include "ss/footer.html" %}

<script>
 document.getElementById("size-select").addEventListener("change", function () {
    const selectedOption = this.options[this.selectedIndex];
    const soluong = selectedOption.dataset.soluong;
    const gia = selectedOption.dataset.gia;

    document.getElementById("tonkho").textContent = soluong ? `Tồn kho: ${soluong} sản phẩm` : '';

    if(gia){
      const giadoi = new Intl.NumberFormat('vi-VN').format(gia);
      document.getElementById("giatien").textContent = giadoi;
    }
});
</script>